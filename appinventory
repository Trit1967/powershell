
# Test script to identify .NET 7 components WITHOUT uninstalling anything
$logFile = "\\ionmazutil004\temp\DotNet7_TestMode_$(Get-Date -Format 'yyyyMMdd-HHmmss').txt"
$computerName = $env:COMPUTERNAME

# Function to log messages
function Write-Log {
    param([string]$message)
    $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
    "$timestamp - $message" | Out-File -FilePath $logFile -Append
    Write-Host $message
}

Write-Log "TEST MODE: Identifying .NET 7 components on computer: $computerName"
Write-Host "RUNNING IN TEST MODE - Nothing will be uninstalled" -ForegroundColor Yellow

# Get all installed applications
$installedApps = @()
$installedApps += Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*"
$installedApps += Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*"

# First, let's get ALL .NET components for comparison
$allDotNetComponents = $installedApps | Where-Object { 
    $_.DisplayName -match "\.NET" 
} | Select-Object DisplayName, Publisher, InstallDate

Write-Log "All .NET components found on system ($($allDotNetComponents.Count) total):"
foreach ($component in $allDotNetComponents) {
    Write-Log "- $($component.DisplayName)"
}

# Now target only the core .NET 7 components
$coreDotNet7Components = $installedApps | Where-Object { 
    $_.DisplayName -match "\.NET Runtime - 7\.0" -or 
    $_.DisplayName -match "\.NET Host - 7\.0" -or
    $_.DisplayName -match "\.NET Host FX Resolver - 7\.0" -or
    $_.DisplayName -match "\.NET SDK 7\.0" -or
    $_.DisplayName -match "ASP\.NET Core 7\.0.*Shared Framework"
} | Select-Object DisplayName, UninstallString

Write-Log ""
Write-Log "COMPONENTS THAT WOULD BE UNINSTALLED ($($coreDotNet7Components.Count) total):"
foreach ($component in $coreDotNet7Components) {
    Write-Log "- $($component.DisplayName)"
}

Write-Log ""
Write-Log "TEST COMPLETE: Review this log to verify only .NET 7 components would be affected."
Write-Host "Test completed. Review log file for details: $logFile" -ForegroundColor Green
Write-Host "If the results look correct, you can run the real uninstall script." -ForegroundColor Green
